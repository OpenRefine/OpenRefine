/** @license MIT - N3.js 0.8.1 (browser build) - Â©Ruben Verborgh */
!function(e){!function(){function t(e,t){for(var r in h)t?e.prototype[r]=i(h[r]):e[r]=h[r];return e}function i(e){return function(t){return e(this,t)}}var r="http://www.w3.org/2001/XMLSchema#",s=r+"string",n=r+"integer",a=r+"decimal",u=r+"boolean",c="http://www.w3.org/1999/02/22-rdf-syntax-ns#langString",h={isIRI:function(e){if(!e)return e;var t=e[0];return'"'!==t&&"_"!==t},isLiteral:function(e){return e&&'"'===e[0]},isBlank:function(e){return e&&"_:"===e.substr(0,2)},getLiteralValue:function(e){var t=/^"([^]*)"/.exec(e);if(!t)throw new Error(e+" is not a literal");return t[1]},getLiteralType:function(e){var t=/^"[^]*"(?:\^\^([^"]+)|(@)[^@"]+)?$/.exec(e);if(!t)throw new Error(e+" is not a literal");return t[1]||(t[2]?c:s)},getLiteralLanguage:function(e){var t=/^"[^]*"(?:@([^@"]+)|\^\^[^"]+)?$/.exec(e);if(!t)throw new Error(e+" is not a literal");return t[1]?t[1].toLowerCase():""},isPrefixedName:function(e){return e&&/^[^:\/"']*:[^:\/"']+$/.test(e)},expandPrefixedName:function(e,t){var i,r,s,n=/(?:^|"\^\^)([^:\/#"'\^_]*):[^\/]*$/.exec(e);return n&&(i=n[1],r=t[i],s=n.index),void 0===r?e:0===s?r+e.substr(i.length+1):e.substr(0,s+3)+r+e.substr(s+i.length+4)},createIRI:function(e){return e&&'"'===e[0]?h.getLiteralValue(e):e},createLiteral:function(e,t){if(!t)switch(typeof e){case"boolean":t=u;break;case"number":if(isFinite(e)){t=e%1===0?n:a;break}default:return'"'+e+'"'}return'"'+e+(/^[a-z]+(-[a-z0-9]+)*$/i.test(t)?'"@'+t.toLowerCase():'"^^'+t)},prefix:function(e){return h.prefixes({"":e})("")},prefixes:function(e){function t(e,t){if(t||!(e in i)){var r=Object.create(null);t=t||"",i[e]=function(e){return r[e]||(r[e]=t+e)}}return i[e]}var i=Object.create(null);for(var r in e)t(r,e[r]);return t}};e.Util=t(t)}(),function(){function t(e){if(!(this instanceof t))return new t(e);if(e=e||{},e.lineMode){this._tripleQuotedString=this._number=this._boolean=/$0^/;var i=this;this._tokenize=this.tokenize,this.tokenize=function(e,t){this._tokenize(e,function(e,r){!e&&/^(?:IRI|prefixed|literal|langcode|type|\.|eof)$/.test(r.type)?t&&t(e,r):t&&t(e||i._syntaxError(r.type,t=null))})}}this._n3Mode=e.n3!==!1,this._comments=!!e.comments}var i=String.fromCharCode,r="function"==typeof setImmediate?setImmediate:function(e){setTimeout(e,0)},s=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\[uU]|\\(.)/g,n={"\\":"\\","'":"'",'"':'"',n:"\n",r:"\r",t:"	",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},a=/[\x00-\x20<>\\"\{\}\|\^\`]/;t.prototype={_iri:/^<((?:[^ <>{}\\]|\\[uU])+)>[ \t]*/,_unescapedIri:/^<([^\x00-\x20<>\\"\{\}\|\^\`]*)>[ \t]*/,_unescapedString:/^"[^"\\]+"(?=[^"\\])/,_singleQuotedString:/^"[^"\\]*(?:\\.[^"\\]*)*"(?=[^"\\])|^'[^'\\]*(?:\\.[^'\\]*)*'(?=[^'\\])/,_tripleQuotedString:/^""("[^"\\]*(?:(?:\\.|"(?!""))[^"\\]*)*")""|^''('[^'\\]*(?:(?:\\.|'(?!''))[^'\\]*)*')''/,_langcode:/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,_prefix:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s<])/,_prefixed:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?:[ \t]+|(?=\.?[,;!\^\s#()\[\]\{\}"'<]))/,_variable:/^\?(?:(?:[A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=[.,;!\^\s#()\[\]\{\}"'<])/,_blank:/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?:[ \t]+|(?=\.?[,;:\s#()\[\]\{\}"'<]))/,_number:/^[\-+]?(?:\d+\.?\d*([eE](?:[\-\+])?\d+)|\d*\.?\d+)(?=[.,;:\s#()\[\]\{\}"'<])/,_boolean:/^(?:true|false)(?=[.,;\s#()\[\]\{\}"'<])/,_keyword:/^@[a-z]+(?=[\s#<:])/i,_sparqlKeyword:/^(?:PREFIX|BASE|GRAPH)(?=[\s#<:])/i,_shortPredicates:/^a(?=\s+|<)/,_newline:/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,_comment:/#([^\n\r]*)/,_whitespace:/^[ \t]+/,_endOfFile:/^(?:#[^\n\r]*)?$/,_tokenizeToEnd:function(e,t){function i(t){e(t._syntaxError(/^\S*/.exec(r)[0]))}for(var r=this._input,s=this._comments;;){for(var n,u;n=this._newline.exec(r);)s&&(u=this._comment.exec(n[0]))&&e(null,{line:this._line,type:"comment",value:u[1],prefix:""}),r=r.substr(n[0].length,r.length),this._line++;if((n=this._whitespace.exec(r))&&(r=r.substr(n[0].length,r.length)),this._endOfFile.test(r))return t&&(s&&(u=this._comment.exec(r))&&e(null,{line:this._line,type:"comment",value:u[1],prefix:""}),e(r=null,{line:this._line,type:"eof",value:"",prefix:""})),this._input=r;var c,h=this._line,f="",d="",_="",o=r[0],l=null,p=0,b=!1;switch(o){case"^":if(r.length<3)break;if("^"!==r[1]){this._n3Mode&&(p=1,f="^");break}if(this._prevTokenType="^^",r=r.substr(2),"<"!==r[0]){b=!0;break}case"<":if(l=this._unescapedIri.exec(r))f="IRI",d=l[1];else if(l=this._iri.exec(r)){if(c=this._unescape(l[1]),null===c||a.test(c))return i(this);f="IRI",d=c}else this._n3Mode&&r.length>1&&"="===r[1]&&(f="inverse",p=2,d="http://www.w3.org/2000/10/swap/log#implies");break;case"_":((l=this._blank.exec(r))||t&&(l=this._blank.exec(r+" ")))&&(f="blank",_="_",d=l[1]);break;case'"':case"'":if(l=this._unescapedString.exec(r))f="literal",d=l[0];else if(l=this._singleQuotedString.exec(r)){if(c=this._unescape(l[0]),null===c)return i(this);f="literal",d=c.replace(/^'|'$/g,'"')}else if(l=this._tripleQuotedString.exec(r)){if(c=l[1]||l[2],this._line+=c.split(/\r\n|\r|\n/).length-1,c=this._unescape(c),null===c)return i(this);f="literal",d=c.replace(/^'|'$/g,'"')}break;case"?":this._n3Mode&&(l=this._variable.exec(r))&&(f="var",d=l[0]);break;case"@":"literal"===this._prevTokenType&&(l=this._langcode.exec(r))?(f="langcode",d=l[1]):(l=this._keyword.exec(r))&&(f=l[0]);break;case".":if(1===r.length?t:r[1]<"0"||r[1]>"9"){f=".",p=1;break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":(l=this._number.exec(r))&&(f="literal",d='"'+l[0]+'"^^http://www.w3.org/2001/XMLSchema#'+(l[1]?"double":/^[+\-]?\d+$/.test(l[0])?"integer":"decimal"));break;case"B":case"b":case"p":case"P":case"G":case"g":(l=this._sparqlKeyword.exec(r))?f=l[0].toUpperCase():b=!0;break;case"f":case"t":(l=this._boolean.exec(r))?(f="literal",d='"'+l[0]+'"^^http://www.w3.org/2001/XMLSchema#boolean'):b=!0;break;case"a":(l=this._shortPredicates.exec(r))?(f="abbreviation",d="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"):b=!0;break;case"=":this._n3Mode&&r.length>1&&(f="abbreviation",">"!==r[1]?(p=1,d="http://www.w3.org/2002/07/owl#sameAs"):(p=2,d="http://www.w3.org/2000/10/swap/log#implies"));break;case"!":if(!this._n3Mode)break;case",":case";":case"[":case"]":case"(":case")":case"{":case"}":p=1,f=o;break;default:b=!0}if(b&&("@prefix"!==this._prevTokenType&&"PREFIX"!==this._prevTokenType||!(l=this._prefix.exec(r))?((l=this._prefixed.exec(r))||t&&(l=this._prefixed.exec(r+" ")))&&(f="prefixed",_=l[1]||"",d=this._unescape(l[2])):(f="prefix",d=l[1]||"")),"^^"===this._prevTokenType)switch(f){case"prefixed":f="type";break;case"IRI":f="typeIRI";break;default:f=""}if(!f)return t||!/^'''|^"""/.test(r)&&/\n|\r/.test(r)?i(this):this._input=r;e(null,{line:h,type:f,value:d,prefix:_}),this._prevTokenType=f,r=r.substr(p||l[0].length,r.length)}},_unescape:function(e){try{return e.replace(s,function(e,t,r,s){var a;if(t){if(a=parseInt(t,16),isNaN(a))throw new Error;return i(a)}if(r){if(a=parseInt(r,16),isNaN(a))throw new Error;return 65535>=a?i(a):i(55296+(a-=65536)/1024,56320+(1023&a))}var u=n[s];if(!u)throw new Error;return u})}catch(t){return null}},_syntaxError:function(e){return this._input=null,new Error('Unexpected "'+e+'" on line '+this._line+".")},tokenize:function(e,t){var i=this;if(this._line=1,"string"==typeof e){if(this._input=e,"function"!=typeof t){var s,n=[];if(this._tokenizeToEnd(function(e,t){e?s=e:n.push(t)},!0),s)throw s;return n}r(function(){i._tokenizeToEnd(t,!0)})}else this._input="","function"==typeof e.setEncoding&&e.setEncoding("utf8"),e.on("data",function(e){null!==i._input&&(i._input+=e,i._tokenizeToEnd(t,!1))}),e.on("end",function(){null!==i._input&&i._tokenizeToEnd(t,!0)})}},e.Lexer=t}(),function(){function t(e){if(!(this instanceof t))return new t(e);this._contextStack=[],this._graph=null,e=e||{},this._setBase(e.documentIRI);var s="string"==typeof e.format?e.format.match(/\w*$/)[0].toLowerCase():"",n="turtle"===s,a="trig"===s,u=/triple/.test(s),c=/quad/.test(s),h=this._n3Mode=/n3/.test(s),f=u||c;(this._supportsNamedGraphs=!(n||h))||(this._readPredicateOrNamedGraph=this._readPredicate),this._supportsQuads=!(n||a||u||h),f&&(this._base="",this._resolveIRI=function(e){return this._error("Disallowed relative IRI",e),this._callback=i,this._subject=null}),this._blankNodePrefix="string"!=typeof e.blankNodePrefix?"":"_:"+e.blankNodePrefix.replace(/^_:/,""),this._lexer=e.lexer||new r({lineMode:f,n3:h}),this._explicitQuantifiers=!!e.explicitQuantifiers}function i(){}var r=e.Lexer,s="http://www.w3.org/1999/02/22-rdf-syntax-ns#",n=s+"nil",a=s+"first",u=s+"rest",c="urn:n3:quantifiers",h=/^[a-z][a-z0-9+.-]*:/i,f=/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i,d=/(?:^|\/)\.\.?(?:$|[\/#?])/,_=0,o=0;t._resetBlankNodeIds=function(){_=o=0},t.prototype={_setBase:function(e){if(e){var t=e.indexOf("#");t>=0&&(e=e.substr(0,t)),this._base=e,this._basePath=e.indexOf("/")<0?e:e.replace(/[^\/?]*(?:\?.*)?$/,""),e=e.match(f),this._baseRoot=e[0],this._baseScheme=e[1]}else this._base=null},_saveContext:function(e,t,i,r,s){var n=this._n3Mode;this._contextStack.push({subject:i,predicate:r,object:s,graph:t,type:e,inverse:n?this._inversePredicate:!1,blankPrefix:n?this._prefixes._:"",quantified:n?this._quantified:null}),n&&(this._inversePredicate=!1,this._prefixes._=this._graph+".",this._quantified=Object.create(this._quantified))},_restoreContext:function(){var e=this._contextStack.pop(),t=this._n3Mode;this._subject=e.subject,this._predicate=e.predicate,this._object=e.object,this._graph=e.graph,t&&(this._inversePredicate=e.inverse,this._prefixes._=e.blankPrefix,this._quantified=e.quantified)},_readInTopContext:function(e){switch(e.type){case"eof":return null!==this._graph?this._error("Unclosed graph",e):(delete this._prefixes._,this._callback(null,null,this._prefixes));case"PREFIX":this._sparqlStyle=!0;case"@prefix":return this._readPrefix;case"BASE":this._sparqlStyle=!0;case"@base":return this._readBaseIRI;case"{":if(this._supportsNamedGraphs)return this._graph="",this._subject=null,this._readSubject;case"GRAPH":if(this._supportsNamedGraphs)return this._readNamedGraphLabel;default:return this._readSubject(e)}},_readEntity:function(e,t){var i;switch(e.type){case"IRI":case"typeIRI":i=null===this._base||h.test(e.value)?e.value:this._resolveIRI(e);break;case"type":case"blank":case"prefixed":var r=this._prefixes[e.prefix];if(void 0===r)return this._error('Undefined prefix "'+e.prefix+':"',e);i=r+e.value;break;case"var":return e.value;default:return this._error("Expected entity but got "+e.type,e)}return!t&&this._n3Mode&&i in this._quantified&&(i=this._quantified[i]),i},_readSubject:function(e){switch(this._predicate=null,e.type){case"[":return this._saveContext("blank",this._graph,this._subject="_:b"+o++,null,null),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,n,null,null),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._graph="_:b"+o++,null,null),this._readSubject):this._error("Unexpected graph",e);case"}":return this._readPunctuation(e);case"@forSome":return this._subject=null,this._predicate="http://www.w3.org/2000/10/swap/reify#forSome",this._quantifiedPrefix="_:b",this._readQuantifierList;case"@forAll":return this._subject=null,this._predicate="http://www.w3.org/2000/10/swap/reify#forAll",this._quantifiedPrefix="?b-",this._readQuantifierList;default:if(!(this._subject=this._readEntity(e)))return;if(this._n3Mode)return this._getPathReader(this._readPredicateOrNamedGraph)}return this._readPredicateOrNamedGraph},_readPredicate:function(e){var t=e.type;switch(t){case"inverse":this._inversePredicate=!0;case"abbreviation":this._predicate=e.value;break;case".":case"]":case"}":return null===this._predicate?this._error("Unexpected "+t,e):(this._subject=null,"]"===t?this._readBlankNodeTail(e):this._readPunctuation(e));case";":return this._readPredicate;case"blank":if(!this._n3Mode)return this._error("Disallowed blank node as predicate",e);default:if(!(this._predicate=this._readEntity(e)))return}return this._readObject},_readObject:function(e){switch(e.type){case"literal":return this._object=e.value,this._readDataTypeOrLang;case"[":return this._saveContext("blank",this._graph,this._subject,this._predicate,this._subject="_:b"+o++),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this._subject,this._predicate,n),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph="_:b"+o++),this._readSubject):this._error("Unexpected graph",e);default:if(!(this._object=this._readEntity(e)))return;if(this._n3Mode)return this._getPathReader(this._getTripleEndReader())}return this._getTripleEndReader()},_readPredicateOrNamedGraph:function(e){return"{"===e.type?this._readGraph(e):this._readPredicate(e)},_readGraph:function(e){return"{"!==e.type?this._error("Expected graph but got "+e.type,e):(this._graph=this._subject,this._subject=null,this._readSubject)},_readBlankNodeHead:function(e){return"]"===e.type?(this._subject=null,this._readBlankNodeTail(e)):(this._predicate=null,this._readPredicate(e))},_readBlankNodeTail:function(e){if("]"!==e.type)return this._readBlankNodePunctuation(e);null!==this._subject&&this._triple(this._subject,this._predicate,this._object,this._graph);var t=null===this._predicate;return this._restoreContext(),null===this._object?t?this._readPredicateOrNamedGraph:this._readPredicate:this._getTripleEndReader()},_readDataTypeOrLang:function(e){var t;switch(e.type){case"type":case"typeIRI":t="^^"+this._readEntity(e);break;case"langcode":t="@"+e.value.toLowerCase();break;default:return this._readCallback=this._getTripleEndReader(),this._readCallback(e)}return this._object+=t,this._getTripleEndReader()},_readListItem:function(e){var t=null,i=null,r=this._subject,s=this._contextStack,c=s[s.length-1],h=this._readListItem;switch(e.type){case"[":this._saveContext("blank",this._graph,i="_:b"+o++,a,this._subject=t="_:b"+o++),h=this._readBlankNodeHead;break;case"(":this._saveContext("list",this._graph,i="_:b"+o++,a,n),this._subject=null;break;case")":if(this._restoreContext(),0!==s.length&&"list"===s[s.length-1].type&&this._triple(this._subject,this._predicate,this._object,this._graph),null===this._predicate){if(h=this._readPredicate,this._subject===n)return h}else if(h=this._getTripleEndReader(),this._object===n)return h;i=n;break;case"literal":t=e.value,h=this._readDataTypeOrLang;break;default:if(!(t=this._readEntity(e)))return}if(null===i&&(this._subject=i="_:b"+o++),null===r?null===c.predicate?c.subject=i:c.object=i:this._triple(r,u,i,this._graph),null!==t){if(this._n3Mode&&("IRI"===e.type||"prefixed"===e.type))return this._saveContext("item",this._graph,i,a,t),this._subject=t,this._predicate=null,this._getPathReader(this._readListItem);this._triple(i,a,t,this._graph)}return h},_readFormulaTail:function(e){return"}"!==e.type?this._readPunctuation(e):(null!==this._subject&&this._triple(this._subject,this._predicate,this._object,this._graph),this._restoreContext(),null===this._object?this._readPredicate:this._getTripleEndReader())},_readPunctuation:function(e){var t,i=this._subject,r=this._graph,s=this._inversePredicate;switch(e.type){case"}":if(null===this._graph)return this._error("Unexpected graph closing",e);if(this._n3Mode)return this._readFormulaTail(e);this._graph=null;case".":this._subject=null,t=this._contextStack.length?this._readSubject:this._readInTopContext,s&&(this._inversePredicate=!1);break;case";":t=this._readPredicate;break;case",":t=this._readObject;break;default:if(this._supportsQuads&&null===this._graph&&(r=this._readEntity(e))){t=this._readQuadPunctuation;break}return this._error('Expected punctuation to follow "'+this._object+'"',e)}if(null!==i){var n=this._predicate,a=this._object;s?this._triple(a,n,i,r):this._triple(i,n,a,r)}return t},_readBlankNodePunctuation:function(e){var t;switch(e.type){case";":t=this._readPredicate;break;case",":t=this._readObject;break;default:return this._error('Expected punctuation to follow "'+this._object+'"',e)}return this._triple(this._subject,this._predicate,this._object,this._graph),t},_readQuadPunctuation:function(e){return"."!==e.type?this._error("Expected dot to follow quad",e):this._readInTopContext},_readPrefix:function(e){return"prefix"!==e.type?this._error("Expected prefix to follow @prefix",e):(this._prefix=e.value,this._readPrefixIRI)},_readPrefixIRI:function(e){if("IRI"!==e.type)return this._error('Expected IRI to follow prefix "'+this._prefix+':"',e);var t=this._readEntity(e);return this._prefixes[this._prefix]=t,this._prefixCallback(this._prefix,t),this._readDeclarationPunctuation},_readBaseIRI:function(e){return"IRI"!==e.type?this._error("Expected IRI to follow base declaration",e):(this._setBase(null===this._base||h.test(e.value)?e.value:this._resolveIRI(e)),this._readDeclarationPunctuation)},_readNamedGraphLabel:function(e){switch(e.type){case"IRI":case"blank":case"prefixed":return this._readSubject(e),this._readGraph;case"[":return this._readNamedGraphBlankLabel;default:return this._error("Invalid graph label",e)}},_readNamedGraphBlankLabel:function(e){return"]"!==e.type?this._error("Invalid graph label",e):(this._subject="_:b"+o++,this._readGraph)},_readDeclarationPunctuation:function(e){return this._sparqlStyle?(this._sparqlStyle=!1,this._readInTopContext(e)):"."!==e.type?this._error("Expected declaration to end with a dot",e):this._readInTopContext},_readQuantifierList:function(e){var t;switch(e.type){case"IRI":case"prefixed":if(t=this._readEntity(e,!0))break;default:return this._error("Unexpected "+e.type,e)}return this._explicitQuantifiers?(null===this._subject?this._triple(this._graph||"",this._predicate,this._subject="_:b"+o++,c):this._triple(this._subject,u,this._subject="_:b"+o++,c),this._triple(this._subject,a,t,c)):this._quantified[t]=this._quantifiedPrefix+o++,this._readQuantifierPunctuation},_readQuantifierPunctuation:function(e){return","===e.type?this._readQuantifierList:(this._explicitQuantifiers&&(this._triple(this._subject,u,n,c),this._subject=null),this._readCallback=this._getTripleEndReader(),this._readCallback(e))},_getPathReader:function(e){return this._afterPath=e,this._readPath},_readPath:function(e){switch(e.type){case"!":return this._readForwardPath;case"^":return this._readBackwardPath;default:var t=this._contextStack,i=t.length&&t[t.length-1];if(i&&"item"===i.type){var r=this._subject;this._restoreContext(),this._triple(this._subject,a,r,this._graph)}return this._afterPath(e)}},_readForwardPath:function(e){var t,i,r="_:b"+o++;if(i=this._readEntity(e))return null===this._predicate?(t=this._subject,this._subject=r):(t=this._object,this._object=r),this._triple(t,i,r,this._graph),this._readPath},_readBackwardPath:function(e){var t,i,r="_:b"+o++;if(t=this._readEntity(e))return null===this._predicate?(i=this._subject,this._subject=r):(i=this._object,this._object=r),this._triple(r,t,i,this._graph),this._readPath},_getTripleEndReader:function(){var e=this._contextStack;if(!e.length)return this._readPunctuation;switch(e[e.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem;case"formula":return this._readFormulaTail}},_triple:function(e,t,i,r){this._callback(null,{subject:e,predicate:t,object:i,graph:r||""})},_error:function(e,t){this._callback(new Error(e+" on line "+t.line+"."))},_resolveIRI:function(e){var t=e.value;switch(t[0]){case void 0:return this._base;case"#":return this._base+t;case"?":return this._base.replace(/(?:\?.*)?$/,t);case"/":return("/"===t[1]?this._baseScheme:this._baseRoot)+this._removeDotSegments(t);default:return this._removeDotSegments(this._basePath+t)}},_removeDotSegments:function(e){if(!d.test(e))return e;for(var t="",i=e.length,r=-1,s=-1,n=0,a="/";i>r;){switch(a){case":":if(0>s&&"/"===e[++r]&&"/"===e[++r])for(;(s=r+1)<i&&"/"!==e[s];)r=s;break;case"?":case"#":r=i;break;case"/":if("."===e[r+1])switch(a=e[++r+1]){case"/":t+=e.substring(n,r-1),n=r+1;break;case void 0:case"?":case"#":return t+e.substring(n,r)+e.substr(r+1);case".":if(a=e[++r+1],void 0===a||"/"===a||"?"===a||"#"===a){if(t+=e.substring(n,r-2),(n=t.lastIndexOf("/"))>=s&&(t=t.substr(0,n)),"/"!==a)return t+"/"+e.substr(r+1);n=r+1}}}a=e[++r]}return t+e.substring(n)},parse:function(e,t,r){var s=this;if(this._readCallback=this._readInTopContext,this._sparqlStyle=!1,this._prefixes=Object.create(null),this._prefixes._=this._blankNodePrefix||"_:b"+_++ +"_",this._inversePredicate=!1,this._quantified=Object.create(null),!t&&!r){var n,a=[];if(this._callback=function(e,t){e?n=e:t&&a.push(t)},this._lexer.tokenize(e).every(function(e){return s._readCallback=s._readCallback(e)}),n)throw n;return a}this._callback=t||i,this._prefixCallback=r||i,this._lexer.tokenize(e,function(e,t){null!==e?(s._callback(e),s._callback=i):s._readCallback&&(s._readCallback=s._readCallback(t))})}},e.Parser=t}(),function(){function t(e,i){if(!(this instanceof t))return new t(e,i);if(e&&"function"!=typeof e.write&&(i=e,e=null),i=i||{},e)this._outputStream=e,this._endStream=void 0===i.end?!0:!!i.end;else{var r="";this._outputStream={write:function(e,t,i){r+=e,i&&i()},end:function(e){e&&e(null,r)}},this._endStream=!0}this._subject=null,/triple|quad/i.test(i.format)?this._writeTriple=this._writeTripleLine:(this._graph="",this._prefixIRIs=Object.create(null),i.prefixes&&this.addPrefixes(i.prefixes))}function i(e){var t=c[e];return void 0===t&&(1===e.length?(t=e.charCodeAt(0).toString(16),t="\\u0000".substr(0,6-t.length)+t):(t=(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)+9216).toString(16),t="\\U00000000".substr(0,10-t.length)+t)),t}var r=/^"([^]*)"(?:\^\^(.+)|@([\-a-z]+))?$/i,s="http://www.w3.org/1999/02/22-rdf-syntax-ns#",n=s+"type",a=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,u=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,c={"\\":"\\\\",'"':'\\"',"	":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"};t.prototype={_write:function(e,t){this._outputStream.write(e,"utf8",t)},_writeTriple:function(e,t,i,r,s){try{this._graph!==r&&(this._write((null===this._subject?"":this._graph?"\n}\n":".\n")+(r?this._encodeIriOrBlankNode(r)+" {\n":"")),this._subject=null,this._graph="["!==r[0]?r:"]"),this._subject===e?this._predicate===t?this._write(", "+this._encodeObject(i),s):this._write(";\n    "+this._encodePredicate(this._predicate=t)+" "+this._encodeObject(i),s):this._write((null===this._subject?"":".\n")+this._encodeSubject(this._subject=e)+" "+this._encodePredicate(this._predicate=t)+" "+this._encodeObject(i),s)}catch(n){s&&s(n)}},_writeTripleLine:function(e,t,i,r,s){delete this._prefixMatch;try{this._write(this._encodeIriOrBlankNode(e)+" "+this._encodeIriOrBlankNode(t)+" "+this._encodeObject(i)+(r?" "+this._encodeIriOrBlankNode(r)+".\n":".\n"),s)}catch(n){s&&s(n)}},_encodeIriOrBlankNode:function(e){var t=e[0];if("["===t||"("===t||"_"===t&&":"===e[1])return e;a.test(e)&&(e=e.replace(u,i));var r=this._prefixRegex.exec(e);return r?r[1]?this._prefixIRIs[r[1]]+r[2]:e:"<"+e+">"},_encodeLiteral:function(e,t,r){return a.test(e)&&(e=e.replace(u,i)),r?'"'+e+'"@'+r:t?'"'+e+'"^^'+this._encodeIriOrBlankNode(t):'"'+e+'"'},_encodeSubject:function(e){if('"'===e[0])throw new Error("A literal as subject is not allowed: "+e);return"["===e[0]&&(this._subject="]"),this._encodeIriOrBlankNode(e)},_encodePredicate:function(e){if('"'===e[0])throw new Error("A literal as predicate is not allowed: "+e);return e===n?"a":this._encodeIriOrBlankNode(e)},_encodeObject:function(e){if('"'!==e[0])return this._encodeIriOrBlankNode(e);var t=r.exec(e);if(!t)throw new Error("Invalid literal: "+e);return this._encodeLiteral(t[1],t[2],t[3])},_blockedWrite:function(){throw new Error("Cannot write because the writer has been closed.")},addTriple:function(e,t,i,r,s){void 0===i?this._writeTriple(e.subject,e.predicate,e.object,e.graph||"",t):"string"!=typeof r?this._writeTriple(e,t,i,"",r):this._writeTriple(e,t,i,r,s)},addTriples:function(e){for(var t=0;t<e.length;t++)this.addTriple(e[t])},addPrefix:function(e,t,i){var r={};r[e]=t,this.addPrefixes(r,i)},addPrefixes:function(e,t){var i=this._prefixIRIs,r=!1;for(var s in e){var n=e[s];/[#\/]$/.test(n)&&i[n]!==(s+=":")&&(r=!0,i[n]=s,null!==this._subject&&(this._write(this._graph?"\n}\n":".\n"),this._subject=null,this._graph=""),this._write("@prefix "+s+" <"+n+">.\n"))}if(r){var a="",u="";for(var c in i)a+=a?"|"+c:c,u+=(u?"|":"")+i[c];a=a.replace(/[\]\/\(\)\*\+\?\.\\\$]/g,"\\$&"),this._prefixRegex=new RegExp("^(?:"+u+")[^/]*$|^("+a+")([a-zA-Z][\\-_a-zA-Z0-9]*)$")}this._write(r?"\n":"",t)},blank:function(e,t){var i,r,s=e;switch(void 0===e?s=[]:"string"==typeof e?s=[{predicate:e,object:t}]:"length"in e||(s=[e]),r=s.length){case 0:return"[]";case 1:if(i=s[0],"["!==i.object[0])return"[ "+this._encodePredicate(i.predicate)+" "+this._encodeObject(i.object)+" ]";default:for(var n="[",a=0;r>a;a++)i=s[a],i.predicate===e?n+=", "+this._encodeObject(i.object):(n+=(a?";\n  ":"\n  ")+this._encodePredicate(i.predicate)+" "+this._encodeObject(i.object),e=i.predicate);return n+"\n]"}},list:function(e){for(var t=e&&e.length||0,i=new Array(t),r=0;t>r;r++)i[r]=this._encodeObject(e[r]);return"("+i.join(" ")+")"},_prefixRegex:/$0^/,end:function(e){null!==this._subject&&(this._write(this._graph?"\n}\n":".\n"),this._subject=null),this._write=this._blockedWrite;var t=e&&function(i,r){t=null,e(i,r)};if(this._endStream)try{return this._outputStream.end(t)}catch(i){}t&&t()}},e.Writer=t}(),function(){function t(e,i){return this instanceof t?(this._size=0,this._graphs=Object.create(null),this._id=0,this._ids=Object.create(null),this._ids["><"]=0,this._entities=Object.create(null),this._blankNodeIndex=0,i||!e||e[0]||(i=e,e=null),i=i||{},this._prefixes=Object.create(null),i.prefixes&&this.addPrefixes(i.prefixes),void(e&&this.addTriples(e))):new t(e,i)}var i=e.Util.expandPrefixedName,r="urn:n3:defaultGraph";t.prototype={get size(){var e=this._size;if(null!==e)return e;var t,i,r=this._graphs;for(var s in r)for(var n in t=r[s].subjects)for(var a in i=t[n])e+=Object.keys(i[a]).length;return this._size=e},get defaultGraph(){return r},_addToIndex:function(e,t,i,r){var s=e[t]||(e[t]={}),n=s[i]||(s[i]={}),a=r in n;return a||(n[r]=null),!a},_removeFromIndex:function(e,t,i,r){var s,n=e[t],a=n[i];delete a[r];for(s in a)return;delete n[i];for(s in n)return;delete e[t]},_findInIndex:function(e,t,i,r,s,n,a,u){var c,h,f,d=[],_=!t+!i+!r,o=_>1?Object.keys(this._ids):this._entities;t&&((c=e,e={})[t]=c[t]);for(var l in e){var p=o[l];if(h=e[l]){i&&((c=h,h={})[i]=c[i]);for(var b in h){var x=o[b];if(f=h[b])for(var g=(r?r in f?[r]:[]:Object.keys(f)),v=g.length-1;v>=0;v--){var j={subject:"",predicate:"",object:"",graph:u};j[s]=p,j[n]=x,j[a]=o[g[v]],d.push(j)}}}}return d},_countInIndex:function(e,t,i,r){var s,n,a,u=0;t&&((s=e,e={})[t]=s[t]);for(var c in e)if(n=e[c]){i&&((s=n,n={})[i]=s[i]);for(var h in n)(a=n[h])&&(r?r in a&&u++:u+=Object.keys(a).length)}return u},addTriple:function(e,t,i,s){t||(s=e.graph,i=e.object,t=e.predicate,e=e.subject),s=s||r;var n=this._graphs[s];n||(n=this._graphs[s]={subjects:{},predicates:{},objects:{}},Object.freeze(n));var a=this._ids,u=this._entities;e=a[e]||(a[u[++this._id]=e]=this._id),t=a[t]||(a[u[++this._id]=t]=this._id),i=a[i]||(a[u[++this._id]=i]=this._id);var c=this._addToIndex(n.subjects,e,t,i);return this._addToIndex(n.predicates,t,i,e),this._addToIndex(n.objects,i,e,t),this._size=null,c},addTriples:function(e){for(var t=e.length-1;t>=0;t--)this.addTriple(e[t])},addPrefix:function(e,t){this._prefixes[e]=t},addPrefixes:function(e){for(var t in e)this.addPrefix(t,e[t])},removeTriple:function(e,t,i,s){t||(s=e.graph,i=e.object,t=e.predicate,e=e.subject),s=s||r;var n,a=this._ids,u=this._graphs;if(!(e=a[e]))return!1;if(!(t=a[t]))return!1;if(!(i=a[i]))return!1;if(!(n=u[s]))return!1;var c,h;if(!(c=n.subjects[e]))return!1;if(!(h=c[t]))return!1;if(!(i in h))return!1;this._removeFromIndex(n.subjects,e,t,i),this._removeFromIndex(n.predicates,t,i,e),this._removeFromIndex(n.objects,i,e,t),null!==this._size&&this._size--;for(e in n.subjects)return!0;return delete u[s],!0},removeTriples:function(e){for(var t=e.length-1;t>=0;t--)this.removeTriple(e[t])},find:function(e,t,r,s){var n=this._prefixes;return this.findByIRI(i(e,n),i(t,n),i(r,n),i(s,n))},findByIRI:function(e,t,i,s){var n,a,u,c,h=[],f={},d=this._ids;s?f[s]=this._graphs[s]:f=this._graphs;for(var _ in f)if(n=f[_]){if(e&&!(a=d[e]))return h;if(t&&!(u=d[t]))return h;if(i&&!(c=d[i]))return h;_===r&&(_=""),h.push(a?c?this._findInIndex(n.objects,c,a,u,"object","subject","predicate",_):this._findInIndex(n.subjects,a,u,null,"subject","predicate","object",_):u?this._findInIndex(n.predicates,u,c,null,"predicate","object","subject",_):c?this._findInIndex(n.objects,c,null,null,"object","subject","predicate",_):this._findInIndex(n.subjects,null,null,null,"subject","predicate","object",_))}return 1===h.length?h[0]:h.concat.apply([],h)},count:function(e,t,r,s){var n=this._prefixes;return this.countByIRI(i(e,n),i(t,n),i(r,n),i(s,n))},countByIRI:function(e,t,i,s){s=s||r;var n=this._graphs[s],a=this._ids;return n?e&&!(e=a[e])?0:t&&!(t=a[t])?0:i&&!(i=a[i])?0:e?i?this._countInIndex(n.objects,i,e,t):this._countInIndex(n.subjects,e,t,i):t?this._countInIndex(n.predicates,t,i,e):this._countInIndex(n.objects,i,e,t):0},createBlankNode:function(e){var t,i;if(e)for(t=e="_:"+e,i=1;this._ids[t];)t=e+i++;else do t="_:b"+this._blankNodeIndex++;while(this._ids[t]);return this._ids[t]=++this._id,this._entities[this._id]=t,t}},e.Store=t}()}("undefined"!=typeof exports?exports:this.N3={});