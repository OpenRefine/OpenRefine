os: linux
language: java
dist: bionic

jobs:
  include:
    - dist: trusty # Fastest build first & for all builds
      jdk: oraclejdk8 # Trusty default
    - jdk: openjdk14 # Latest JRE

services:
  - mysql
  - postgresql 

before_install:
  # Fake out packaging for Travis builds before mvn install
  - cp packaging/travis_pom.xml packaging/pom.xml
  - mvn process-resources

before_script:
  # create test databases for mysql, mariadb and postgresql
  - mysql -u root -e 'CREATE DATABASE test_db;'
  - mysql -u root test_db < extensions/database/tests/conf/travis-mysql.sql
  - psql -c 'CREATE DATABASE test_db;' -U postgres
  - psql -U postgres test_db < extensions/database/tests/conf/travis-pgsql.sql
  - cp extensions/database/tests/conf/travis_tests.xml extensions/database/tests/conf/tests.xml

script:
  - mvn jacoco:prepare-agent test

after_success:
  - mvn prepare-package -DskipTests=true
  - mvn jacoco:report coveralls:report

cache:
  directories:
  - $HOME/.m2

